# ConfigMaps for Todo Application
#
# Contains non-sensitive configuration that can be mounted as environment
# variables or files. Changes to ConfigMaps are hot-reloaded by the pods.
apiVersion: v1
kind: ConfigMap
metadata:
  name: backend-config
  namespace: todo-app
  labels:
    app: backend
    component: api
data:
  # Application settings
  ENVIRONMENT: "production"
  LOG_LEVEL: "info"
  # CORS origins (comma-separated list)
  CORS_ORIGINS: "http://localhost,http://localhost:3000,https://todo-app.local"
  # JWT settings
  JWT_ALGORITHM: "HS256"
  ACCESS_TOKEN_EXPIRE_MINUTES: "15"
  REFRESH_TOKEN_EXPIRE_DAYS: "7"
  # Rate limiting
  RATE_LIMIT_ENABLED: "true"
  RATE_LIMIT_PER_MINUTE: "60"
  # Dapr settings
  DAPR_HTTP_PORT: "3500"
  DAPR_GRPC_PORT: "50001"
  # Pub/Sub settings
  KAFKA_BROKERS: "kafka.kafka.svc.cluster.local:9092"
  KAFKA_TOPIC_TASKS: "task-events"

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: frontend-config
  namespace: todo-app
  labels:
    app: frontend
    component: ui
data:
  # Application settings
  NEXT_PUBLIC_ENVIRONMENT: "production"
  NEXT_PUBLIC_APP_NAME: "Todo App"
  NEXT_PUBLIC_APP_VERSION: "0.1.0"
  # Backend API URL (uses Kubernetes service discovery)
  NEXT_PUBLIC_API_URL: "http://backend.todo-app.svc.cluster.local"
  # Feature flags
  NEXT_PUBLIC_ENABLE_AI_CHAT: "true"
  NEXT_PUBLIC_ENABLE_SPEECH: "true"
  NEXT_PUBLIC_ENABLE_DARK_MODE: "true"
  # Internationalization
  NEXT_PUBLIC_DEFAULT_LOCALE: "en"
  NEXT_PUBLIC_SUPPORTED_LOCALES: "en,es,fr,de,ar"

---
# NGINX configuration for custom routing (optional)
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-config
  namespace: todo-app
  labels:
    app: todo-app
    component: ingress
data:
  nginx.conf: |
    worker_processes auto;
    events {
      worker_connections 1024;
    }
    http {
      upstream frontend {
        server frontend.todo-app.svc.cluster.local:80;
      }
      upstream backend {
        server backend.todo-app.svc.cluster.local:80;
      }
      server {
        listen 80;
        # Frontend routes
        location / {
          proxy_pass http://frontend;
          proxy_set_header Host $host;
          proxy_set_header X-Real-IP $remote_addr;
          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
          proxy_set_header X-Forwarded-Proto $scheme;
        }
        # Backend API routes
        location /api/ {
          proxy_pass http://backend;
          proxy_set_header Host $host;
          proxy_set_header X-Real-IP $remote_addr;
          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
          proxy_set_header X-Forwarded-Proto $scheme;
        }
        # Health check
        location /health {
          proxy_pass http://backend;
          access_log off;
        }
      }
    }
